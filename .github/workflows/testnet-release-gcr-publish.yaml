name: Testnet Build and Publish Image to GCR #TODO: different name for mainnet

# on:
#   push:
#     tags:
#       - '*-rc-*' #TODO: mainnet '*-alpha-*' tag name convention

on:
  release:
    types: [published]
  
jobs:
  deploy:
    runs-on: ubuntu-latest
#ON PUSH
#     if: ${{ endsWith(github.event.base_ref, 'workflows') }} #TODO: mainnet or testnet branch name
# ON RELEASE PUBLISHED
#TODO: mainnet '*-alpha-*' tag name convention
#TODO: branch names mainnet and testnet
#     if: ${{ (contains(github.event.release.tag_name, '-rc-') && endsWith(github.event.release.target_commitish, 'workflows')) }}
    steps:
      - uses: actions/checkout@v2
      
      - run: echo "TAG NAME ${GITHUB_REF/refs\/tags\//}"
      
      - run: echo "TEST 2 conditions ${{ (contains(github.event.release.tag_name, '-rc-') && endsWith(github.event.release.target_commitish, 'workflows')) }} "
      
      - run: echo "FALSE TEST 2 conditions 1 ${{ (contains(github.event.release.tag_name, 'wrong') && endsWith(github.event.release.target_commitish, 'workflows')) }} "
      - run: echo "FALSE TEST 2 conditions 2 ${{ (contains(github.event.release.tag_name, '-rc-') && endsWith(github.event.release.target_commitish, 'wrong')) }} "
      - run: echo "FALSE TEST 2 conditions 3 ${{ (contains(github.event.release.tag_name, 'wrong') && endsWith(github.event.release.target_commitish, 'wrong')) }} "
      
      
#ON RELEASE PUBLISHED
      - run: echo "release.tag_name ${{ github.event.release.tag_name }}"
      - run: echo "if tag containts -rc- ${{ contains(github.event.release.tag_name, '-rc-') }}"
      - run: echo "if ! tag containts -rc- ${{ !contains(github.event.release.tag_name, '-rc-') }}"
      
      - run: echo "release.target_commitish ${{ github.event.release.target_commitish }}"
      - run: echo "if target commitish workflows ${{ endsWith(github.event.release.target_commitish, 'workflows') }}"
      - run: echo "if ! target commitish workflows ${{ !endsWith(github.event.release.target_commitish, 'workflows') }}"

#ON PUSH
#       - run: echo "github base ref ${{ github.event.base_ref }}"
#       - run: echo " if ! ends with workflows ${{ !endsWith(github.event.base_ref, 'workflows') }}"
#       - run: echo " if ends with workflows ${{ endsWith(github.event.base_ref, 'workflows') }}"
      
#       - name: Exit if not on workflows branch
#         if: ${{ !endsWith(github.event.base_ref, 'workflows') }}
#         run:  echo "Branch is WRONG-SKIP. IF endsWith workflows FALSE"
        
    
#       - name: DO stuff on workflows branch
#         if: ${{ endsWith(github.event.base_ref, 'workflows') }}
#         run:  echo "Branch is workflows. OK."

      - run: echo "üçè This job's status is ${{ job.status }}."
   

   
   
#       - name: Setup GCloud SDK
#         uses: google-github-actions/setup-gcloud@v0.2.0
#         with:
#           project_id: ${{ secrets.GCP_PROJECT }}
#           service_account_key: ${{ secrets.GCP_SA_KEY }}

#       - name: Authorize Docker
#         run: gcloud auth configure-docker

# TODO Testnet 

#       - name: Build and Push Container
#         run: |-
#           docker build \
#             -t gcr.io/${{ secrets.GCP_PROJECT }}/${{ secrets.SERVICE }}:${GITHUB_REF/refs\/tags\//} \
#             -f build/Dockerfile .
#           docker push gcr.io/${{ secrets.GCP_PROJECT }}/${{ secrets.SERVICE }}:${GITHUB_REF/refs\/tags\//}

# TODO Mainnet

#       - name: Build and Push Container
#         run: |-
#           docker build \
#             -t gcr.io/${{ secrets.GCP_PROJECT }}/${{ secrets.SERVICE }}:${GITHUB_REF/refs\/tags\//} \
#             -t gcr.io/${{ secrets.GCP_PROJECT }}/${{ secrets.SERVICE }}:latest \
#             -f build/Dockerfile .
#           docker push gcr.io/${{ secrets.GCP_PROJECT }}/${{ secrets.SERVICE }}:${GITHUB_REF/refs\/tags\//}
#           docker push gcr.io/${{ secrets.GCP_PROJECT }}/${{ secrets.SERVICE }}:latest
